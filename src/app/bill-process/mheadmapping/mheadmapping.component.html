
<div class="container-fluid pb-5">
    <mat-card>
        <h2>Functional User Mapping</h2>

        <form [formGroup]="MHMapGrp" #options="ngForm">
            <div class="row mt-4 align-items-center">

              <div class="col-12 col-sm-12 col-md-4 col-lg-4 col-xl-4 col-xxl-4">
                <mat-form-field class="w-100" appearance="legacy">
                    <mat-label> Treasury</mat-label>
                    <input type="text" placeholder="Pick one" aria-label="Number" matInput (paste)="(false)"
                        formControlName="TreasuryControl" [matAutocomplete]="autoTreas" [(ngModel)]="ChooseOption">
                    <mat-icon class="" style=" position: absolute;right:2px; top:0px">arrow_drop_down
                    </mat-icon>
                    <mat-autocomplete #autoTreas="matAutocomplete" [displayWith]="displayTreasFn">
                        <mat-option *ngFor="let option of Treasuryoptions | async" [value]="option">
                            {{option.TreasuryName}}
                        </mat-option>
                    </mat-autocomplete>
                    <mat-error *ngIf="MHMapGrp.get('TreasuryControl').invalid && MHMapGrp.get('TreasuryControl').touched">Please Select Treasury ! </mat-error>
                </mat-form-field>
             </div>

             <div class="col-12 col-sm-12 col-md-4 col-lg-4 col-xl-4 col-xxl-4">
                <mat-form-field class="w-100" appearance="legacy">
                    <mat-label> Fin Year</mat-label>
                    <input type="text" placeholder="Pick one" aria-label="Number" matInput (paste)="(false)" formControlName="Year">
               </mat-form-field>
            </div>



                <div class="col-12 col-sm-12 col-md-4 col-lg-4 col-xl-4 col-xxl-4">
                    <mat-radio-group aria-label="Select an option" [(ngModel)]="radioOptions"
                        formControlName="rblTypeCtrl" (change)="onRadioButtonChange($event)">
                        <mat-radio-button color="primary"  class="ms-3" value="1">Auditor
                        </mat-radio-button>
                        <mat-radio-button color="primary" class="ms-3" value="2">Accountant
                        </mat-radio-button>
                        <mat-radio-button color="primary" class="ms-3" value="3">Both
                        </mat-radio-button>

                        <mat-error *ngIf="MHMapGrp.get('rblTypeCtrl').invalid && MHMapGrp.get('rblTypeCtrl').touched">Please Select Option </mat-error>
                    </mat-radio-group>
                </div>

                <div class="col-12 col-sm-12 col-md-4 col-lg-4 col-xl-4 col-xxl-4">
                    <mat-form-field class="w-100" appearance="legacy">
                        <mat-label>Select User</mat-label>
                        <input type="text" placeholder="Pick one" aria-label="Number" matInput (paste)="(false)"
                            formControlName="ddlUserList" [matAutocomplete]="auto" [(ngModel)]="SelectUserType" />
                        <mat-icon class="" style="position: absolute; right: 2px; top: 0px">arrow_drop_down
                        </mat-icon>
                        <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayUserList">

                            <mat-option *ngFor="let option of userTypeListOptions | async" [value]="option"
                                (click)="OnUsertypeSelected(SelectUserType)">
                                {{ option.EmployeeId }}
                            </mat-option>
                        </mat-autocomplete>
                    <mat-error *ngIf="MHMapGrp.get('ddlUserList').invalid && MHMapGrp.get('ddlUserList').touched">Please select User</mat-error>
                    </mat-form-field>
                </div>

                <div class="col-12 col-sm-12 col-md-4 col-lg-4 col-xl-4 col-xxl-4">
                  <mat-radio-group aria-label="Select an option"
                      formControlName="typeMajor" (change)="onMajorRadioButtonChange($event)">
                      <mat-radio-button color="primary"  class="ms-3" value="1">Major
                      </mat-radio-button>
                      <mat-radio-button color="primary" class="ms-3" value="2">Budget Head
                      </mat-radio-button>
                      <mat-radio-button color="primary" class="ms-3" value="3">DDO Code
                      </mat-radio-button>

                      <mat-error *ngIf="MHMapGrp.get('typeMajor').invalid && MHMapGrp.get('typeMajor').touched">Please Select  Major Type</mat-error>

                  </mat-radio-group>
              </div>

              <div class="col-12 col-sm-12 col-md-4 col-lg-4 col-xl-4 col-xxl-4">
                <mat-form-field class="w-100" appearance="legacy">

                  <input
                    matInput
                    [matDatepicker]="activeDate"
                    title="Active Date"
                    formControlName="activeDate"
                  />
                  <mat-datepicker-toggle
                    matSuffix
                    [for]="activeDate"
                  ></mat-datepicker-toggle>
                  <mat-datepicker #activeDate></mat-datepicker>

                  <mat-error
                    *ngIf="
                    MHMapGrp.get('activeDate').hasError(
                        'required'
                      ) || MHMapGrp.get('activeDate').touched
                    "
                  >
                  Active Date is required
                  </mat-error>
                </mat-form-field>
              </div>








         <div  *ngIf="typeMajorId==1">
            <div class="col-12 col-sm-12 col-md-10 col-lg-10 col-xl-10 col-xxl-10">
                 <mat-form-field class="w-100" appearance="outline">


                    <mat-form-field class="w-100" appearance="legacy">
                       <mat-label>Search Major Head</mat-label>
                        <input matInput id="myInput" placeholder="Enter For Search Major Head" class="input-control" #box
                            style="width:60% ;" [formControl]="search"  />
                        <mat-icon matSuffix style="position: absolute;right:1%;margin-top: -22px;">search</mat-icon>
                    </mat-form-field>


                        <div class="example-1 scrollbar-ripe-malinka">

                            <mat-selection-list #shoes (selectionChange)="selectionChange($event.option)" formControlName="majorHead">

                                    <mat-list-option *ngFor="let MajorHead of $search | async" [value]="MajorHead"
                                    [selected]="MajorHeadControl.value && MajorHeadControl.value?.indexOf(MajorHead)>=0">
                                    <span>{{ MajorHead.MajorHeadCodeName }}</span>
                                </mat-list-option>
                            </mat-selection-list>


                        </div>

                 </mat-form-field>

            </div>
            </div>


            <div  *ngIf="typeMajorId==2" class="col-12 col-sm-12 col-md-10 col-lg-10 col-xl-10 col-xxl-10 ">
              <mat-form-field class="w-100 " appearance="outline">
                  <mat-label>Select Major Head</mat-label>
                  <input type="text"class="div-Major" placeholder="Pick one" aria-label="Number" matInput (paste)="(false)"
                     [matAutocomplete]="autoMajor" formControlName="selecteMajorType"  />
                  <mat-icon class="" style="position: absolute; right: 2px; top: 0px">arrow_drop_down
                  </mat-icon>
                  <mat-autocomplete #autoMajor="matAutocomplete" [displayWith]="displayMajorHeadList"  >

                      <mat-option *ngFor="let MajorHead of majorHeadDataList | async" [value]="MajorHead"
                      (click)="OnMajorHeadtypeSelected(MajorHead)"
                      >
                          {{ MajorHead.MajorHeadCodeName }}
                      </mat-option>
                  </mat-autocomplete>
              <mat-error *ngIf="MHMapGrp.invalid">Please select Major Head </mat-error>
              </mat-form-field>
          </div>


            <div *ngIf="typeMajorId==2">
            <div class="col-12 col-sm-12 col-md-10 col-lg-10 col-xl-10 col-xxl-10">
              <mat-form-field class="w-100" appearance="outline">

                 <mat-form-field class="w-100" appearance="legacy">
                   <mat-label>Search Budget Head</mat-label>
                     <input matInput id="myInput" placeholder="Enter For Search Budget Head" class="input-control" #box
                         style="width:60% ;" [formControl]="searchBudgetHead"  />
                     <mat-icon matSuffix style="position: absolute;right:1%;margin-top: -22px;">search</mat-icon>
                 </mat-form-field>
                     <div class="example-1 scrollbar-ripe-malinka">
                         <mat-selection-list #shoes (selectionChange)="selectionBudgetChange($event.option)" formControlName="searchBudgetHead" >

                                 <mat-list-option *ngFor="let BudgetHead of $searchBudgetHead | async" [value]="BudgetHead"
                                 [selected]="BudgetHeadControl.value && BudgetHeadControl.value?.indexOf(BudgetHead)>=0">
                                 <span>{{ BudgetHead.groupsubheadname }}</span>
                             </mat-list-option>
                         </mat-selection-list>


                     </div>

              </mat-form-field>

         </div>
         </div>

         <div *ngIf="typeMajorId==3">
         <div class="col-12 col-sm-12 col-md-10 col-lg-10 col-xl-10 col-xxl-10">
          <mat-form-field class="w-100" appearance="outline">

             <mat-form-field class="w-100" appearance="legacy">
               <mat-label>Search DDO Code</mat-label>
                 <input matInput id="myInput" [formControl]="DDOCodesearch" placeholder="Enter For Search DDO Code" class="input-control" #box
                     style="width:60% ;"  />
                 <mat-icon matSuffix style="position: absolute;right:1%;margin-top: -22px;">search</mat-icon>
             </mat-form-field>
                 <div class="example-1 scrollbar-ripe-malinka">
                     <mat-selection-list #shoes (selectionChange)="selectionDDOCodeChange($event.option)" formControlName="DDOCode">

                             <mat-list-option *ngFor="let DDOCode of $DDOCodesearch | async" [value]="DDOCode"
                             [selected]="DDOCodeControl.value && DDOCodeControl.value?.indexOf(DDOCode)>=0">
                             <span>{{ DDOCode.DDO_NAME }}</span>
                         </mat-list-option>
                     </mat-selection-list>
                 </div>
          </mat-form-field>
     </div>
        </div>

      </div>

        <div class="row">
            <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-xxl-12">
                <div class="float-end">
                         <!-- <button   mat-raised-button color="primary" [disabled]="!options.valid" (click)="assignMH()" type="submit" *ngIf="isAddBtnVisible">{{btnAdd}}</button> -->
                         <button   mat-raised-button color="primary" [disabled]="!options.valid" (click)="assignMH()" type="submit" >Submit</button>
                         <button mat-stroked-button color="primary" class="ms-3"  (click)="ResetPage()" type="submit"> Reset</button>
                 </div>
             </div>
            </div>

        </form>

    </mat-card>



    <mat-card class="mt-3" *ngIf="showTab_Table">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12 col-sm-12 col-md-6 col-lg-4" >
                        <mat-form-field appearance="standard"  role="search" class="w-100">
                            <input matInput type="search" placeholder="Enter For Search"
                                aria-label="Search" (keyup)="applyFilter($any($event.target).value)">
                            <mat-icon matSuffix>search</mat-icon>
                        </mat-form-field>
                    </div>
                </div>
            </div>
            <div class="scroll-container" style="overflow: auto">
                <table mat-table matSort matTableExporter [dataSource]="MHAssignList"
                    style="width:100%" (matSortChange)="announceSortChange($event)" matSort
                    class="mat-elevation-z8" id="test">


                    <ng-container matColumnDef="SrNo">
                        <th mat-header-cell *matHeaderCellDef   mat-sort-header
                            sortActionDescription="Sort by SrNo" class="OBListHdrFont">
                            SrNo
                        </th>
                        <td mat-cell *matCellDef="let item; let j = index"> {{ (j+1) +
                            (myPaginator.pageIndex * myPaginator.pageSize) }} </td>
                    </ng-container>

                    <ng-container matColumnDef="ByUser">
                    <th mat-header-cell *matHeaderCellDef   mat-sort-header
                        sortActionDescription="Sort by ByUser" class="OBListHdrFont">
                        By User
                    </th>
                    <td mat-cell *matCellDef="let element"> {{element.ByUser}}
                    </td>
                </ng-container>


                    <ng-container matColumnDef="MajorHeads">
                        <th mat-header-cell *matHeaderCellDef  mat-sort-header
                            sortActionDescription="Sort by MajorHeads"
                            class="OBListHdrFont">
                            MajorHeads
                        </th>
                        <td mat-cell *matCellDef="let element"> {{element.MajorHeads}} </td>
                    </ng-container>

                    <ng-container matColumnDef="BudgetHead">
                      <th mat-header-cell *matHeaderCellDef  mat-sort-header
                          sortActionDescription="Sort by BudgetHead"
                          class="OBListHdrFont">
                          Budget Head
                      </th>
                      <td mat-cell *matCellDef="let element"> {{element.BudgetHead}} </td>
                  </ng-container>

                  <ng-container matColumnDef="DdoName">
                    <th mat-header-cell *matHeaderCellDef  mat-sort-header
                        sortActionDescription="Sort by DdoName"
                        class="OBListHdrFont">
                        DDO Name
                    </th>
                    <td mat-cell *matCellDef="let element"> {{element.DdoName}} </td>
                </ng-container>


                    <ng-container matColumnDef="TransDate">
                        <th mat-header-cell *matHeaderCellDef  mat-sort-header
                            sortActionDescription="Sort by TransDate" class="OBListHdrFont">
                            Trans Date
                        </th>
                        <td mat-cell *matCellDef="let element"> {{element.TransDate}} </td>
                    </ng-container>


                    <ng-container matColumnDef="RevokeDate">
                        <th mat-header-cell *matHeaderCellDef  mat-sort-header
                            sortActionDescription="Sort by RevokeDate" class="OBListHdrFont">
                            Revoke Date
                        </th>
                        <td mat-cell *matCellDef="let element"> {{element.RevokeDate}} </td>
                    </ng-container>




                    <ng-container matColumnDef="Action">
                        <th mat-header-cell *matHeaderCellDef  mat-sort-header
                            sortActionDescription="Sort by Action" class="OBListHdrFont">
                            Action
                        </th>
                        <td mat-cell *matCellDef="let row">
                        <button *ngIf="row.MajorHeads!=null " class="mat-raised-button"  [ngClass]="[row.RevokeDate == '-' ? 'showRevoke' : 'hideRevoke disabled']" type="button" (click)="UpdateMajorHeadsAuditorMap(row)">Revoke</button>
                        <button  *ngIf="row.MajorHeads !=null"  class="mat-raised-button" [ngClass]="[row.RevokeDate != '-' ? 'showEnable' : 'hideEnable disabled']" type="button" (click)="UpdateMajorHeadsAuditorMap(row)">Enable</button>

                      <button *ngIf="row.BudgetHead !=null"  class="mat-raised-button"  [ngClass]="[row.RevokeDate == '-' ? 'showRevoke' : 'hideRevoke disabled']" type="button" (click)="UpdateBudgetHeadAuditorMap(row)">Revoke</button>
                      <button *ngIf="row.BudgetHead !=null" class="mat-raised-button" [ngClass]="[row.RevokeDate != '-' ? 'showEnable' : 'hideEnable disabled']" type="button" (click)="UpdateBudgetHeadAuditorMap(row)"> Enable</button>

                    <button *ngIf="row.DdoCode !=null" class="mat-raised-button"  [ngClass]="[row.RevokeDate == '-' ? 'showRevoke' : 'hideRevoke disabled']" type="button" (click)="UpdateDDOCodeAuditorMap(row)"> Revoke</button>
                    <button *ngIf="row.DdoCode !=null" class="mat-raised-button" [ngClass]="[row.RevokeDate != '-' ? 'showEnable' : 'hideEnable disabled']" type="button" (click)="UpdateDDOCodeAuditorMap(row)"> Enable</button>
                </td>


                    </ng-container>

                    <ng-container matColumnDef="empty-row">
                        <td mat-cell *matCellDef="let element">Data Not Found !</td>
                    </ng-container>



                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

                </table>
            </div>

            <mat-paginator #myPaginator [length]="5" [pageSize]="5"
            [pageSizeOptions]="[5,10,15,20]" showFirstLastButtons>

        </mat-paginator>

    </mat-card>
</div>



<div *ngIf="this.loader.getLoading()" class="cssload-container">
    <div class="cssload-speeding-wheel"></div>
</div>
